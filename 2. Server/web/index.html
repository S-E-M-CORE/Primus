<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Management</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .pagination {
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1>Member Management</h1>

        <!-- Form to add a new member -->
        <div class="row mt-4">
            <div class="col-md-6">
                <h3>Add New Member</h3>
                <form id="addMemberForm">
                    <div class="mb-3">
                        <label for="firstName" class="form-label">First Name</label>
                        <input type="text" class="form-control" id="firstName" name="firstName" required>
                    </div>
                    <div class="mb-3">
                        <label for="lastName" class="form-label">Last Name</label>
                        <input type="text" class="form-control" id="lastName" name="lastName" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="phoneNumber" class="form-label">Phone Number</label>
                        <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" required>
                    </div>
                    <div class="mb-3">
                        <label for="birthDate" class="form-label">Birth Date</label>
                        <input type="date" class="form-control" id="birthDate" name="birthDate" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Member</button>
                </form>
            </div>
        </div>

        <!-- Member List -->
        <div class="row mt-4">
            <div class="col-md-12">
                <h3>All Members</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">First Name</th>
                            <th scope="col">Last Name</th>
                            <th scope="col">Email</th>
                            <th scope="col">Phone Number</th>
                            <th scope="col">Birth Date</th>
                            <th scope="col">Create Date</th>
                            <th scope="col">Active</th>
                        </tr>
                    </thead>
                    <tbody id="memberList"></tbody>
                </table>
                <nav aria-label="Page navigation">
                    <ul id="pagination" class="pagination"></ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Your custom script to fetch and display data -->
    <script>
        const pageSize = 5; // Number of members per page
        let currentPage = 1; // Current page

        // Function to fetch members for a given page
        function fetchMembers(page) {
            fetch(`http://localhost:8000/api/members/total/all?offset=${(page - 1) * pageSize}&limit=${pageSize}`)
                .then(response => response.json())
                .then(data => {
                    const members = data.items;
                    const list = document.getElementById('memberList');
                    list.innerHTML = ''; // Clear previous list

                    // Add members to the list
                    members.forEach(member => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${member.id}</td>
                            <td>${member.firstName}</td>
                            <td>${member.lastName}</td>
                            <td>${member.email}</td>
                            <td>${member.phoneNumber}</td>
                            <td>${member.birthDate}</td>
                            <td>${member.createDate}</td>
                            <td>${member.active}</td>
                        `;
                        list.appendChild(row);
                    });
                });
        }

        // Function to handle form submission for adding a new member
        document.getElementById('addMemberForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            const memberData = {};
            formData.forEach((value, key) => {
                memberData[key] = value;
            });

            fetch('http://localhost:8000/api/member', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(memberData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Member added successfully:', data);
                // Refresh member list after adding a new member
                fetchMembers(currentPage);
            })
            .catch(error => console.error('Error adding member:', error));
        });

        // Function to update pagination
        function updatePagination(totalMembers) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = ''; // Clear previous pagination

            const totalPages = Math.ceil(totalMembers / pageSize);
            for (let i = 1; i <= totalPages; i++) {
                const pageItem = document.createElement('li');
                pageItem.classList.add('page-item');
                const pageLink = document.createElement('a');
                pageLink.classList.add('page-link');
                pageLink.textContent = i;
                pageLink.href = '#';
                pageLink.addEventListener('click', function() {
                    currentPage = i;
                    fetchMembers(currentPage);
                });
                pageItem.appendChild(pageLink);
                pagination.appendChild(pageItem);
            }
        }

        // Initial setup
        fetchMembers(currentPage);
        fetch('http://localhost:8000/api/members/total/count')
            .then(response => response.text())
            .then(totalMembers => updatePagination(parseInt(totalMembers)));
    </script>
</body>
</html>
